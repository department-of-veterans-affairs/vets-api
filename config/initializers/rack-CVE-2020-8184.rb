# rubocop:disable all
# frozen_string_literal: true

module Rack
  module Utils
    module_function def parse_cookies_header(header)
      Rails.logger.info 'SECURITY: Loaded CVE-2020-8184 patch for rack gem'

      return {} unless header

      header.split(/[;] */n).each_with_object({}) do |cookie, cookies|
        next if cookie.empty?

        key, value = cookie.split('=', 2)
        cookies[key] = (unescape(value) rescue value) unless cookies.key?(key)
      end
    end
  end
end
# rubocop:enable all
