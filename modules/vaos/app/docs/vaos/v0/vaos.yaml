openapi: '3.0.0'
info:
  version: 0.0.1
  title: VAOS
  description: |
    ## The API for managing Veterans Affairs Online Scheduling

    These endpoints give hooks into VAOS, an existing product suite, containing a veteran-facing healthcare appointment online scheduling tool of
    the same name (formerly named VAR - Veteran Appointment Request), a scheduler-facing appointment management tool named Schedule Manager, and a schedule configuration utility for VA facilities, named VATS (VA Tool Set).
  contact:
    name: va.gov
tags:
  - name: appointments
    description: Appointments
  - name: systems
    description: Systems
servers:
  - url: https://sandbox-api.va.gov/v0/vaos/{version}
    description: VA.gov API sandbox environment
    variables:
      version:
        default: v0
  - url: https://api.va.gov/v0/vaos/{version}
    description: VA.gov API production environment
    variables:
      version:
        default: v0
paths:
  '/appointments':
    get:
      tags:
        - appointments
      summary: Returns alist of online scheduling appointments
      operationId: getAppointments
      security:
        - bearerAuth: []
      parameters: 
        - in: query
          required: true
          name: type
          description: "type of appointment, e.g. 'va' or 'cc' (community care)"
          schema:
            type: string
        - in: query
          required: true
          name: start_date
          description: "start date for appointments search"
          schema:
            type: string
        - in: query
          required: true
          name: end_date
          description: "end date for appointments search"
          schema:
            type: string
      responses:
        '200':
          description: Appointments retrieved successfully
          content:
            application/json:
              schema:
                required:
                  - data
                properties:
                  data:
                    type: array
                    items:
                      oneOf:
                        - $ref: "#/components/schemas/VAAppointment"
                        - $ref: "#/components/schemas/CCAppointment"
                  meta:
                    $ref: "#/components/schemas/Pagination" 
        '207':
          description: Message body may contain multiple status codes depending on how many subrequests were made.
        '403':
          description: Forbidden, user does not have access to VAOS scheduling.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '502':
          description: Error in the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '504':
          description: Timeout from the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
    post:
      tags:
        - appointments
      summary: Creates an appointment.
      operationId: createAppointment
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAppBody"
      responses:
        '204':
          description: The server successfully created the appointment, and is not returning any content.
        '400':
          description: Bad Request, the server cannot or will not process the request due to an apparent client error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '403':
          description: Forbidden, user does not have access to VAOS scheduling.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '409':
          description: Conflict, indicates that the request could not be processed because of conflict in the current state of the appointment.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '502':
          description: Error in the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '504':
          description: Timeout from the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
  '/appointments/{type}/{id}':
    get:
      tags:
        - appointments
      summary: Returns an appointment of whose id is {id}
      operationId: getAppointment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          required: true
          name: "type"
          description: "type of appointment, e.g. 'va' or 'cc' (community care)"
          schema:
            type: string
        - in: path
          required: true
          name: id
          description: "the id of appointment"
          schema:
            type: string
      responses:
        '200':
          description: Appointment retrieved successfully
          content:
            application/json:
              schema:
                required: 
                  - data
                properties:
                  data:
                    $ref:  "#/components/schemas/VAAppointment"
        '403':
          description: Forbidden, user does not have access to VAOS scheduling.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '404':  
          description: Not Found, appointment resource not found.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '502':
          description: Error in the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '504':
          description: Timeout from the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
  '/appointments/cancel':
    put:
      tags: 
        - appointments
      summary: Cancels an appointment
      operationId: cancelAppointment
      security: 
        - bearerAuth: []
      parameters:
        - in: query
          required: true
          name: appointment_time
          description: The date and time of the appointment. 
          schema:
            type: string
        - in: query
          required: true
          name: facility_id
          description: The facitlity id where the appointment was scheduled.
          schema:
            type: string
        - in: query
          required: true
          name: cancel_code
          description: The code used in cancelling the appointment.
          schema:
            type: string
        - in: query
          name: clinic_id
          description: The clinic id where the appointment was scheduled.
          schema:
            type: string
        - in: query
          name: cancel_reason
          description: The reason the appointment was cancelled.
          schema:
            type: string
        - in: query
          name: remarks
          description: Any remarks entered when cancelling the appointment.
          schema:
            type: string
        - in: query
          name: clinic_name
          description: The name of the clinic where the appointment was scheduled.
          schema:
            type: string
      responses:
        '204':
          description: The server successfully cancelled the appointment, and is not returning any content.
        '409':
          description: Conflict, indicates that the request could not be processed because of conflict in the current state of the appointment.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"

        '422':
          description: Unprocessable Entity, the request was well-formed but was unable to be followed due to parameter validation errors.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
  '/cc_eligibility/{service_type}':
    get:
      tags:
        - cc_eligibility
      summary: Returns cc eligibility status for a user
      operationId: getEligibility
      security:
        - bearerAuth: []
      parameters:
        - in: path
          required: true
          name: "service_type"
          description: "type of service, e.g. 'PrimaryCare' "
          schema:
            type: string
      responses:
        '200':
          description: Eligibility retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CCEligibility"
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"        
  '/facilities/{facility_id}/cancel_reasons':
    get:
      tags:
        - facilities
      summary: Returns a list of cancel reasons from the facility
      security:
        - bearerAuth: []
      parameters:
        - in: path
          required: true
          name: "facility_id"
          schema: 
            type: string
      responses:
        '200':
          description: OK, returns a list of cancel reasons for the facility
          content:
            application/json:
              schema:
                required:
                  - data
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/FacilityCancelReason'
        '403':
          description: Forbidden, the request contained valid data and was understood by the server, but the server is refusing action. This may be due to the user not having the necessary permissions. 
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors" 
        '502':
          description: Error in the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
  '/facilities':
    get:
      tags:
        - facilities
      operationId:  getFacilities
      summary:  Returns a list of facility records for the given facility codes 
      security:
        - bearerAuth: []
      parameters:
        - in: query
          required: true
          name: facility_codes
          schema:
            type: array
            items: 
              type: string
          example: facility_codes[]=405&facility_codes[]=516
      responses:
        '200':
          description: OK, Facility information retrieved successfully
          content:
            application/json:
              schema:
                required:
                  - data
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Facility"
                    example:
                      - id: "405"
                        type: facility
                        attributes:
                          institution_code: "405"
                          city: White River Junction
                          state_abbrev: VT
                          authoritative_name: White River Junction VA Medical Center
                          root_station_code:  "983"
                          admin_parent: true
                          parent_station_code: "405"
                      - id: "516"
                        type: facility
                        attributes:
                          institution_code: "516"
                          city: Bay Pines
                          state_abbrev: FL
                          authoritative_name: C.W. Bill Young Department of Veterans Affairs Medical Center
                          root_station_code:  "983"
                          admin_parent: true
                          parent_station_code: "516"                      
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '502':
          description: Error in the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '504':
          description: Timeout from the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
  '/facilities/limits':
    get:
      tags:
        - facilities
      operationId:  getLimitsForMultipleFacilities
      summary:  Returns a list of limits for multiple facilities for the given type of care and facility ids.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          required: true
          name:  type_of_care_id
          example: "323"
          schema:
            type: string
        - in: query
          required: true
          name: facility_ids
          schema:
            type: array
            items: 
              type: string
          example: facility_ids[]=688&facility_ids[]=442        
      responses:
        '200':
          description: OK, Returns a list of request limits for the type of care for each facility id given
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    number_of_requests:
                      type: integer
                    request_limit:
                      type: integer
                    institution_code:
                      type: string
              example:
                - number_of_requests: 0
                  request_limit:  1
                  institution_code: "688"
                - number_of_requests: 0
                  request_limit:  1
                  institution_code: "442"
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '502':
          description: Error in the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '504':
          description: Timeout from the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
  '/systems':
    get:
      tags:
        - systems
      summary: Returns a list of systems available to the the veteran.
      operationId: getSystems
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Systems retrieved successfully
          content:
            application/json:
              schema:
                required:
                  - data
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/System"
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '502':
          description: Error in the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '504':
          description: Timeout from the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
  '/systems/{system_id}/clinic_institutions':
    get:
      tags:
        - systems
      summary: Returns an expanded clinic model with institution data which is used for finding its correct address.
      operationId: getClinicInstitutions
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: system_id
          schema:
            type: integer
          required: true
          description: the system id for the related clinics
      responses:
        '200':
          description: Facilities retrieved successfully
          content:
            application/json:
              schema:
                required:
                  - data
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/ClinicInstitution"
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '502':
          description: Error in the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '504':
          description: Timeout from the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
  '/systems/{system_id}/direct_scheduling_facilities':
    get:
      tags:
        - systems
      summary: Returns a list of facilities in which the veteran can directly schedule an appointment.
      operationId: getDirectSchedulingFacilities
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: system_id
          schema:
            type: integer
          required: true
          description: the system id for the list of facilities
      responses:
        '200':
          description: Direct schedule facilities retrieved successfully
          content:
            application/json:
              schema:
                required:
                  - data
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/DirectSchedulingFacility"
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '502':
          description: Error in the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '504':
          description: Timeout from the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
  '/systems/{system_id}/pact':
    get:
      tags:
        - systems
      summary: Returns a list of Patient-Aligned Care Teams (PACT).
      description: description
      operationId: getAppealStatus
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: system_id
          schema:
            type: integer
          required: true
          description: the system id for the list of facilities
      responses:
        '200':
          description: Facilities retrieved successfully
          content:
            application/json:
              schema:
                required:
                  - data
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/PACT"
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '502':
          description: Error in the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
        '504':
          description: Timeout from the upstream service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Errors"
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Errors:
      required:
        - "errors"
      properties:
        errors:
          type: "array"
          items:
            type: "object"
            properties:
              status:
                type: "string"
              code:
                type: "string"
              title:
                type: "string"
              detail:
                type: "string"
    FacilityCancelReason:
      type: object
      required: 
        - id
        - type
        - attributes
      properties:
        id:
          type: string
          example: "1"
        type:
          type: string
          example: "cancel_reason"
        attributes:
          type: object
          required:
            - number
            - text
            - type
            - inactive
          properties:
            number:
              type: string
              example: "1"
            text:
              type: string
              example: "WEATHER"    
            type:
              type: string
              example: "B"
              type: boolean
              example: false  
    CCEligibility:
      type: "object"
      required:
        - "id"
        - "type"
        - "attributes"
      properties:
        id:
          type: "string"
        type:
          type: "string"
        attributes:
          type: "object"
          properties:
            eligible:
              type: "boolean"
              example: true
    System:
      type: "object"
      properties:
        id:
          type: "string"
          example: "12345748"
        type:
          type: "string"
          example: "system"
        attributes:
          required:
            - "unique_id"
            - "assigning_authority"
            - "assigning_code"
            - "id_status"
          properties:
            unique_id:
              type: "string"
              example: "12345748"
            assigning_authority:
              type: "string"
              example: "UNKNOWN"
            assigning_code:
              type: "string"
              example: "200MHS"
            id_status:
              type: "string"
              example: "ACTIVE"
          type: "object"

    DirectSchedulingFacility:
      type: "object"
      properties:
        id:
          type: "string"
        type:
          type: "string"
        attributes:
          required:
            - "institution_code"
            - "city"
            - "state_abbrev"
            - "authoritative_name"
            - "root_station_code"
            - "admin_parent"
            - "parent_station_code"
            - "request_supported"
            - "direct_scheduling_supported"
            - "express_times"
            - "institution_timezone"
          properties:
            institution_code:
              type: "string"
              example: '688'
            city:
              type: "string"
              example: 'Washington'
            state_abbrev:
              type: "string"
              example: 'DC'
            authoritative_name:
              type: "string"
              example: 'Washington VA Medical Center'
            root_station_code:
              type: "string"
              example: '688'
            admin_parent:
              type: "boolean"
              example: true
            parent_station_code:
              type: "string"
              example: '688'
            request_supported:
              type: "boolean"
              example: true
            direct_scheduling_supported:
              type: "boolean"
              example: true
            institution_timezone:
              type: "string"
              example: 'America/New_York'
          type: "object"
    ClinicInstitution:
      type: "object"
      properties:
        id:
          type: "string"
          example: "16"
        type:
          type: "string"
          example: "clinic_institution"
        attributes:
          required:
            - "location_ien"
            - "institution_sid"
            - "institution_ien"
            - "institution_name"
            - "institution_code"
          properties:
            location_ien:
              type: "string"
              example: "16"
            institution_sid:
              type: "number"
              example: 561596
            institution_ien:
              type: "string"
              example: "442"
            institution_name:
              type: "string"
              example: "CHEYENNE VA MEDICAL"
            institution_code:
              type: "string"
              example: "442"
          type: "object"
    CCAppointment:
      type: "object"
      properties:
        id:
          type: "string"
          example: "8a48912a6c2409b9016c29cbeed0006a"
        type:
          type: "string"
          example: "cc_appointments"
        attributes:
          required:
            - "appointment_request_id"
            - "distance_eligible_confirmed"
            - "name"
            - "provider_practice"
            - "provider_phone"
            - "address"
            - "instructions_to_veteran"
            - "appointment_time"
            - "time_zone"
          properties:
            appointment_request_id:
              type: "string"
              example: "8a48912a6c2409b9016c29cbeed0006a"
            distance_eligible_confirmed:
              type: "boolean"
              example: true
            name:
              required:
                - "first_name"
                - "last_name"
              properties:
                first_name:
                  type: "string"
                  example: "John"
                last_name:
                  type: "string"
                  example: "Doe"
              type: "object"
            provider_practice:
              type: "string"
              example: "test"
            provider_phone:
              type: "string"
              example: "(321) 230-0328"
            address:
              required:
                - "street"
                - "city"
                - "state"
                - "zip_code"
              properties:
                street:
                  type: "string"
                  example: "test"
                city:
                  type: "string"
                  example: "test"
                state:
                  type: "string"
                  example: "MA"
                zip_code:
                  type: "string"
                  example: "32826"
              type: "object"
            instructions_to_veteran:
              type: "string"
              example: ""
            appointment_time:
              type: "string"
              example: "09/20/2020 16:29:00"
            time_zone:
              type: "string"
              example: "-04:00 EDT"
          type: "object"
    CreateAppBody:
      type: "object"
      properties:
        scheduling_request_type:
          type: string
          example: "NEXT_AVAILABLE_APPT"
        type:
          type: string
          example: "REGULAR"
        appointment_kind:
          type: string
          example:  "TRADITIONAL"
        appointment_type:
          type: string
          example: "Primary Care"
        scheduling_method:
          type: string
          example: "direct"
        appt_type:
          type: string
          example: "P"
        purpose:
          type: string
          example: "9"
        lvl:
          type: string
          example: "1"
        ekg:
          type: string
          example: ""
        lab:
          type: string
          example: ""
        x_ray:
          type: string
          example: ""
        desired_date:
          type: string
          example: "2020-02-07T00:00:00.000+00:00"
        date_time:
          type: string
          example: "2020-02-07T21:00:00.000+00:00"
        duration:
          type: integer
          example: 30
        booking_notes:
          type: string
          example: "Follow-up/Routine: abdominal pain"
        preferred_email:
          type: string
          example: "test@va.gov"
        time_zone:
          type: string
          example: "America/Denver"
        clinic:
          type: "object"
          properties:
            site_code:
              type: string
              example: "983"
            clinic_id:
              type: string
              example: "308"
            clinic_name:
              type: string
              example: "CHY PC KILPATRICK"
            clinic_friendly_location_name:
              type: string
              example: "Green Team Clinic1"
            institution_name:
              type: string
              example: "CHYSHR-Cheyenne VA Medical Center"
            institution_code:
              type: string
              example: "983"
    VAAppointment:
      type: "object"
      properties:
        id:
          type: "string"
          example: "9d82d708c71bb59a6c8a58a05fb469d7"
        type:
          type: "string"
          example: "va_appointments"
        attributes:
          required:
            - "start_date"
            - "clinic_id"
            - "clinic_friendly_name"
            - "facility_id"
            - "community_care"
            - "vds_appointments"
            - "vvs_appointments"
          properties:
            start_date:
              type: "string"
              example: "2019-10-24T17:00:00Z"
            clinic_id:
              type: "string"
              example: "408"
            clinic_friendly_name:
              type: "string"
              example: "Main St. Clinic"
            facility_id:
              type: "string"
              example: "983"
            community_care:
              type: "boolean"
              example: false
            vds_appointments:
              type: "array"
              items:
                type: "object"
                properties:
                  booking_note:
                    type: "string"
                    example: "Testing the direct schedule"
                  appointment_length:
                    type: "string"
                    example: "60"
                  appointment_time:
                    type: "string"
                    example: "2019-10-24T17:00:00Z"
                  clinic:
                    required:
                      - "name"
                      - "ask_for_check_in"
                      - "facility_code"
                    properties:
                      name:
                        type: "string"
                        example: "OPTOMETRY - GRUBBS"
                      ask_for_check_in:
                        type: "boolean"
                        example: false
                      facility_code:
                        type: "string"
                        example: "983"
                    type: "object"
                  type:
                    type: "string"
                    example: "REGULAR"
                  current_status:
                    type: "string"
                    example: "NO ACTION TAKEN/TODAY"
            vvs_appointments:
              type: "array"
              items:
                type: "object"
              example: []
          type: "object"
        meta:
          required:
            - "pagination"
          properties:
            pagination:
              required:
                - "current_page"
                - "per_page"
                - "total_pages"
                - "total_entries"
              properties:
                current_page:
                  type: "number"
                  example: 0
                per_page:
                  type: "number"
                  example: 0
                total_pages:
                  type: "number"
                  example: 0
                total_entries:
                  type: "number"
                  example: 0
              type: "object"
          type: "object"
    Pagination:
      type: "object"
      required:
        - "pagination"
      properties:
        pagination:
          required:
            - "current_page"
            - "per_page"
            - "total_pages"
            - "total_entries"
          properties:
            current_page:
              type: "number"
              example: 0
            per_page:
              type: "number"
              example: 0
            total_pages:
              type: "number"
              example: 0
            total_entries:
              type: "number"
              example: 0
          type: "object"
    PACT:
      type: "object"
      properties:
        id:
          type: "string"
          example: "3780868"
        type:
          type: "string"
          example: "system_pact"
        attributes:
          required:
            - "facility_id"
            - "possible_primary"
            - "provider_position"
            - "provider_sid"
            - "staff_name"
            - "team_name"
            - "team_purpose"
            - "team_sid"
            - "title"
          properties:
            facility_id:
              type: "string"
              example: "688"
            possible_primary:
              type: "string"
              example: "Y"
            provider_position:
              type: "string"
              example: "GREEN-FOUR PHYSICIAN"
            provider_sid:
              type: "string"
              example: "3780868"
            staff_name:
              type: "string"
              example: "VASSALL,NATALIE M"
            team_name:
              type: "string"
              example: "GREEN-FOUR"
            team_purpose:
              type: "string"
              example: "PRIMARY CARE"
            team_sid:
              type: "string"
              example: "1400018881"
            title:
              type: "string"
              example: "PHYSICIAN-ATTENDING"
          type: "object"
