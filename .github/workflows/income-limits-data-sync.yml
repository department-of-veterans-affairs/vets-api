name: Income Limits Data Sync

on:
  push:
  workflow_dispatch: null

jobs:
  query_oracle:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Set up Ruby
      uses: ruby/setup-ruby@v1

    - name: Install Oracle Instant Client Libraries
      run: |
        echo pwd
        cd /opt
        sudo mkdir /opt/oracle
        cd /opt/oracle
        sudo curl https://download.oracle.com/otn_software/linux/instantclient/214000/https://download.oracle.com/otn_software/linux/instantclient/2112000/instantclient-basic-linux.x64-21.12.0.0.0dbru.zip -o /opt/oracle/instantclient-basic-linux.x64-21.12.0.0.0dbru.zip
        sudo curl https://download.oracle.com/otn_software/linux/instantclient/2112000/instantclient-sdk-linux.x64-21.12.0.0.0dbru.zip -o /opt/oracle/instantclient-sdk-linux.x64-21.12.0.0.0dbru.zip
        sudo unzip instantclient-basic-linux.x64-21.12.0.0.0dbru.zip
        sudo unzip instantclient-sdk-linux.x64-21.12.0.0.0dbru.zip
        sudo apt update
        sudo apt install libaio1
        sudo sh -c "echo /opt/oracle/instantclient_21_12 > /etc/ld.so.conf.d/oracle-instantclient.conf"
        sudo ldconfig

    - name: Install Dependencies
      run: |
        gem install ruby-oci8
        gem install csv

    - name: Run Oracle Query
      run: ruby query_oracle.rb
