{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "data":     { "$ref": "#/definitions/data" },
    "included": { "$ref": "#/definitions/included" }
  },
  "additionalProperties": false,
  "required": ["data", "included"],
  "definitions": {


    "nonBlankString": { "type": "string", "pattern": "[^ ]" },
    "nonBlankStringMaxLength100": {
      "allOf": [ { "$ref": "#/definitions/nonBlankString" }, { "maxLength": 100 } ]
    },
    "nonBlankStringMaxLength10": {
      "allOf": [ { "$ref": "#/definitions/nonBlankString" }, { "maxLength": 10 } ]
    },
    "nonBlankStringMaxLength2": {
      "allOf": [ { "$ref": "#/definitions/nonBlankString" }, { "maxLength": 2 } ]
    },


    "data": {
      "type": "object",
      "properties": {
        "type":       { "const": "HigherLevelReview" },
        "attributes": { "$ref": "#/definitions/dataAttributes" }
      },
      "additionalProperties": false,
      "required": [ "type", "attributes" ]
    },


    "dataAttributes": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "informalConference":      { "const": false },
            "sameOffice":              { "type": "boolean" },
            "legacyOptInApproved":     { "type": "boolean" },
            "benefitType":             { "$ref": "#/definitions/benefitType" },
            "veteran":                 { "$ref": "#/definitions/veteran" },
            "claimant":                { "$ref": "#/definitions/claimant" },
            "receiptDate": {
              "type": "string",
              "format": "date",
              "$comment": "if field absent, use today"
            }
          },
          "additionalProperties": false,
          "required": [
            "informalConference",
            "sameOffice",
            "legacyOptInApproved",
            "benefitType",
            "veteran"
          ]
        },
        {
          "$comment": "if informalConference requested, desired times must be included (rep is optional)",
          "type": "object",
          "properties": {
            "informalConference":      { "const": true },
            "sameOffice":              { "type": "boolean" },
            "legacyOptInApproved":     { "type": "boolean" },
            "benefitType":             { "$ref": "#/definitions/benefitType" },
            "veteran":                 { "$ref": "#/definitions/veteran" },
            "claimant":                { "$ref": "#/definitions/claimant" },
            "receiptDate": {
              "type": "string",
              "format": "date",
              "$comment": "if field absent, use today"
            },
            "informalConferenceTimes": { "$ref": "#/definitions/informalConferenceTimes" },
            "informalConferenceRep":   { "$ref": "#/definitions/informalConferenceRep" }
          },
          "additionalProperties": false,
          "required": [
            "informalConference",
            "sameOffice",
            "legacyOptInApproved",
            "benefitType",
            "veteran",
            "informalConferenceTimes"
          ]
        }
      ]
    },


    "benefitType": {
      "type": "string",
      "enum": [
        "compensation",
        "pension",
        "fiduciary",
        "insurance",
        "education",
        "voc_rehab",
        "loan_guaranty",
        "vha",
        "nca"
      ]
    },


    "informalConferenceTimes": {
      "type": "array",
      "items": { "$ref": "#/definitions/informalConferenceTime" },
      "minItems": 1,
      "maxItems": 2,
      "uniqueItems": true
    },


    "informalConferenceTime": {
      "type": "string",
      "enum": [
        "800-1000 ET",
        "1000-1230 ET",
        "1230-1400 ET",
        "1400-1630 ET"
      ]
    },


    "informalConferenceRep": {
      "type": "object",
      "properties": {
        "name":  { "$ref": "#/definitions/nonBlankString" },
        "phone": { "$ref": "#/definitions/phone" }
      },
      "additionalProperties": false,
      "required": [ "name", "phone" ]
    },


    "phone": {
      "$comment": "source: VA Profile API - POST /v0/profile/telephones",
      "type": "object",
      "properties": {
        "is_international": { "type": "boolean" },
        "country_code":     { "$ref": "#/definitions/nonBlankString" },
        "phone_number":     { "type": "string", "pattern": "^[0-9]{1,14}$" },
        "area_code":        { "type": "string", "pattern": "^[0-9]{3}$" },
        "extension":        { "$ref": "#/definitions/nonBlankStringMaxLength10" },
        "phone_type":       { "type": "string", "enum": [ "MOBILE", "HOME", "WORK", "FAX", "TEMPORARY" ] }
      },
      "additionalProperties": false,
      "required": [
        "is_international",
        "country_code",
        "phone_number",
        "area_code",
        "phone_type"
      ]
    },


    "address": {
      "$comment": "source: VA Profile API - POST /v0/profile/addresses",
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "address_type":  { "type": "string", "enum": [ "DOMESTIC", "OVERSEAS MILITARY" ] },
            "address_line1": { "$ref": "#/definitions/nonBlankStringMaxLength100" },
            "address_line2": { "$ref": "#/definitions/nonBlankStringMaxLength100" },
            "address_line3": { "$ref": "#/definitions/nonBlankStringMaxLength100" },
            "city":          { "$ref": "#/definitions/nonBlankStringMaxLength100" },
            "state_code":    { "$ref": "#/definitions/nonBlankStringMaxLength2" },
            "zip_code":      { "type": "string", "pattern": "^[0-9]{5}$" },
            "country_name":  { "type": "string" },
            "address_pou":   { "type": "string", "enum": [ "RESIDENCE/CHOICE", "CORRESPONDENCE" ] }
          },
          "additionalProperties": false,
          "required": [
            "address_type",
            "address_line1",
            "city",
            "state_code",
            "zip_code",
            "country_name",
            "address_pou"
          ]
        },
        {
          "type": "object",
          "properties": {
            "address_type":              { "const": "INTERNATIONAL" },
            "address_line1":             { "$ref": "#/definitions/nonBlankStringMaxLength100" },
            "address_line2":             { "$ref": "#/definitions/nonBlankStringMaxLength100" },
            "address_line3":             { "$ref": "#/definitions/nonBlankStringMaxLength100" },
            "city":                      { "$ref": "#/definitions/nonBlankStringMaxLength100" },
            "international_postal_code": { "type": "string" },
            "country_name":              { "type": "string" },
            "address_pou":               { "type": "string", "enum": [ "RESIDENCE/CHOICE", "CORRESPONDENCE" ] }
          },
          "additionalProperties": false,
          "required": [
            "address_type",
            "address_line1",
            "city",
            "international_postal_code",
            "country_name",
            "address_pou"
          ]
        }
      ]
    },


    "veteran": {
      "type": "object",
      "properties": {
        "ssn":           { "type": "string", "pattern": "^[0-9]{9}$" },
        "address":       { "$ref": "#/definitions/address" },
        "phone":         { "$ref": "#/definitions/phone" },
        "email_address": { "type": "string", "format": "email" }
      },
      "additionalProperties": false,
      "required": [ "ssn" ]
    },


    "claimant": {
      "type": "object",
      "properties": {
        "participantId": { "$ref": "#/definitions/nonBlankString" },
        "payeeCode":     { "$ref": "#/definitions/payeeCode" }
      },
      "additionalProperties": false,
      "required": [ "participantId", "payeeCode" ]
    },


    "payeeCode": {
      "type": "string",
      "enum": [
        "00", "01", "02", "03", "04", "05", "06",
        "07", "08", "09", "10", "11", "12", "13",
        "14", "15", "16", "17", "18", "19", "20",
        "21", "22", "23", "24", "25", "26", "27",
        "28", "29", "30", "31", "32", "33", "34",
        "35", "36", "37", "38", "39", "41", "42",
        "43", "44", "45", "46", "47", "48", "49",
        "50", "60", "70", "71", "72", "73", "74",
        "75", "76", "77", "78", "80", "81", "82",
        "83", "84", "85", "86", "87", "88", "89",
        "99"
      ]
    },


    "included": {
      "type": "array",
      "items": { "$ref": "#/definitions/contestableIssue" },
      "minItems": 1
    },


    "contestableIssue": {
      "type": "object",
      "properties": {
        "type":       { "const": "ContestableIssue" },
        "attributes": { "$ref": "#/definitions/contestableIssueIds" }
      },
      "additionalProperties": false,
      "required": [ "type", "attributes" ]
    },


    "contestableIssueIds": {
      "type": "object",
      "properties": {
        "decisionIssueId":       { "type": "integer" },
        "ratingIssueId":         { "type": "string" },
        "ratingDecisionIssueId": { "type": "string" }
      },
      "additionalProperties": false,
      "$comment": "at least one ID must be present",
      "not": {
        "properties": {
          "decisionIssueId":       { "const": null },
          "ratingIssueId":         { "const": null },
          "ratingDecisionIssueId": { "const": null }
        }
      }
    }
  }
}
